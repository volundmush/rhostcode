@skip isdbref(tag(setr(1,where)))={@assert/inline isdbref(globalroom())=@pemit %#=ERROR: No master room set!;@assert/inline isdbref(setr(0,create(Where System,,t)))=@pemit %#=ERROR: Could not create code object %q1: %q0;@set %q0=INDESTRUCTIBLE !NO_COMMAND;@tag/add %q1=%q0;@tel %q0=globalroom()}

@@ Commands and stuff.
&CMD.WHERE #where=$^(?s)(?\:@|\+)?(where)(?\:/(\\S+)?)?(?\: +(.+?))?(?\:=(.*))?$:@attach #inc/GET_SWITCH=%2;@attach %!/SW.[strfirstof(%q<switch>,MAIN)]=%3,%4
@set #where/CMD.WHERE=regexp

&FN.WHERE.COLUMNS #where=printf($-23s $-11s $-3s $-4s $-4s $-1s $-s,Name,Alias,Fac,Idle,Conn,G,Location)
&FN.WHERE.ROW #where=printf($-23s $-11s $-3s $4s $4s $-1s $-&s,cname(%0),getalias(%0),,hideidle(%0),hideconn(%0),left(default(%0/SEX,?),1),if(!strmatch(setr(!,objeval(%#,loc(%0),3),loc),#-*),cname(%q<loc>),*UNFINDABLE*))

&SW.MAIN #where=@pemit %#=header(Where is Everybody);@pemit %#=ansi(confoverride(%#,COLUMN),u(FN.WHERE.COLUMNS));@pemit %#=separator();@dolist/inline sortname(setdiff(iter(lwho(0,%#,1),objeval(%#,loc(%i0),3)),#-1))={@pemit %#=%d0: [itemize(iter(objeval(%#,lcon(%d0/CONNECT),3),cname(%i0),%b,|),|)]};@pemit %#=footer()